import{C as U}from"./auto-sRkgK8jz.js";import{P as A,c as I}from"./Msg-CiP7AL8w.js";import{T as F,H as B,l as N}from"./loader-B_YgijKb.js";import{_ as L,c as n,a as h,e as p,b as s,r as D,w as f,f as v,d as y,v as k,g as b,F as x,h as V,o as d,t as c}from"./index-x6f1RFcC.js";const T={name:"Campaigns",components:{Header:B,Popup:A,Toogle:F},inject:["appUrl","appUser","appLogout"],data(){return{formData:{},loaderGif:N,data:{items:[]},date:"",date2:"",q:"",sort:"",loader:1,iChart:-1,id:0,type:0,all:!0,chartInstance:null}},computed:{api(){return I(this.appUrl,this.appUser?this.appUser.auth:"")}},mounted(){if(this.appUser&&!this.appUser.auth){this.appLogout();return}this.get()},beforeUnmount(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},methods:{get(){if(this.loader=1,!this.appUrl){console.log("URL API not found"),this.loader=0;return}this.api.getCampaigns({date:this.date,date2:this.date2,q:this.q,sort:this.sort}).then(a=>{this.data=a.data,this.loader=0}).catch(a=>{a.isApiError?console.error(a.message):(console.error(a),this.appLogout()),this.loader=0})},getChart(){if(this.iChart===-1||!this.data.items||!this.data.items[this.iChart])return;const a=this.data.items[this.iChart];this.formData=a,this.api.getCampaignBannersChart(this.formData,{date:this.date,date2:this.date2}).then(t=>{const o=t.data.items?t.data.items:t.data;o&&(o.line&&(this.data.items[this.iChart].line=o.line),o.sites&&(this.data.items[this.iChart].sites=o.sites),o.clicks!==void 0&&(this.data.items[this.iChart].clicks=o.clicks),o.views!==void 0&&(this.data.items[this.iChart].views=o.views),o.leads!==void 0&&(this.data.items[this.iChart].leads=o.leads)),this.renderChart(this.data.items[this.iChart])}).catch(t=>{console.log("Chart error",t)})},line(a){this.$nextTick(()=>{this.$refs.chartOuter?this.getChart():console.error("Element chartOuter not found")})},renderChart(a){this.chartInstance&&this.chartInstance.destroy(),this.$nextTick(()=>{if(!this.$refs.chartOuter)return;const t=[],o=[],w=[],e=new Date(this.date),l=new Date(this.date2);if(!isNaN(e)&&!isNaN(l))for(;e<=l;){const u=e.getFullYear(),m=("0"+(e.getMonth()+1)).slice(-2),g=("0"+e.getDate()).slice(-2),i=`${g}.${m}.${u}`,C=`${u}-${m}-${g}`;t.push(`${g}.${m}.${u}`);let r=null;a&&a.line&&(r=a.line[i]||a.line[C]),r?(o.push(parseInt(r.clicks)||0),w.push(parseInt(r.views)||0)):(o.push(0),w.push(0)),e.setDate(e.getDate()+1)}const _=this.$refs.myChart;_&&(this.chartInstance=new U(_,{type:"line",data:{labels:t,datasets:[{label:"Clicks",backgroundColor:"rgba(9, 132, 227, 0.1)",borderColor:"#0984e3",data:o,yAxisID:"y",tension:.3,fill:!0,pointBackgroundColor:"#0984e3",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6},{label:"Views",backgroundColor:"rgba(108, 92, 231, 0.1)",borderColor:"#6c5ce7",data:w,yAxisID:"y2",tension:.3,fill:!0,pointBackgroundColor:"#6c5ce7",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!1},tooltip:{backgroundColor:"#2d3436",titleFont:{size:13,weight:"600"},bodyFont:{size:12},padding:12,cornerRadius:8,displayColors:!0,boxPadding:4}},scales:{x:{grid:{display:!1},ticks:{color:"#b2bec3",font:{size:11}}},y:{type:"linear",display:!0,position:"right",beginAtZero:!0,grid:{color:"rgba(0,0,0,0.04)",drawBorder:!1},ticks:{color:"#b2bec3",font:{size:11}}},y2:{type:"linear",display:!0,position:"left",beginAtZero:!0,grid:{drawOnChartArea:!1,drawBorder:!1},ticks:{color:"#b2bec3",font:{size:11}}}}}}))})},checkAll(a){if(this.iChart===-1||!this.data.items[this.iChart])return;const t=this.data.items[this.iChart];t&&t.sites&&Object.values(t.sites).forEach(o=>{o.include=a}),this.formData=t,this.getChart()},action(){this.formData&&(this.formData.copy="",this.api.actionCampaign(this.formData).then(a=>{this.$refs.new&&(this.$refs.new.active=0),this.$refs.header&&this.$refs.header.$refs.msg&&(this.formData.id?this.$refs.header.$refs.msg.successFun("Successfully updated campaign!"):this.$refs.header.$refs.msg.successFun("Successfully added new campaign!")),this.get()}).catch(a=>{a.isApiError&&this.$refs.header&&this.$refs.header.$refs.msg?this.$refs.header.$refs.msg.alertFun(a.message):console.log("errors",a)}))},async del(a){this.formData=a,this.$refs.header&&this.$refs.header.$refs.msg&&await this.$refs.header.$refs.msg.confirmFun("Please confirm next action","Do you want to delete this campaign?")&&this.api.deleteCampaign(this.formData).then(t=>{this.$refs.header.$refs.msg.successFun("Successfully deleted campaign!"),this.get()}).catch(t=>{t.isApiError?this.$refs.header.$refs.msg.alertFun(t.message):console.log("errors",t)})},openDetails(a,t){this.$refs.details.active=1}}},H={class:"page-container"},E={key:0,id:"spinner"},R=["src"],P={class:"content-wrapper"},S={class:"toolbar"},z={class:"toolbar-left"},O={class:"toolbar-center"},j={class:"flex panel",style:{display:"flex","justify-content":"space-between",padding:"20px"}},q={class:"w30 ptb25"},M={class:"w70-al",style:{"flex-grow":"1","padding-left":"20px"}},G={class:"flex cubes",style:{display:"flex",gap:"20px","text-align":"center"}},W={class:"w30 clicks"},Z={class:"w38 views"},Y={class:"w30 leads"},J={class:"w38-ctr"},K={class:"flex body",style:{display:"flex","margin-top":"20px"}},Q={class:"w30 ar filchart",style:{width:"30%","border-right":"1px solid #eee","padding-right":"10px"}},X={key:0,class:"itemchart ptb10",style:{padding:"5px 0"}},$={style:{"font-size":"13px"}},tt={class:"w70",ref:"chartOuter",style:{width:"70%","padding-left":"20px"}},et={ref:"chartHints",style:{display:"flex",gap:"10px","justify-content":"center","margin-bottom":"10px"}},st={style:{height:"300px",position:"relative"}},it={ref:"myChart"},at={class:"form-container"},ot={class:"form-group"},lt={class:"form-actions"},rt={key:0,class:"btn-primary"},nt={key:1,class:"btn-primary"},dt={key:0,class:"table-container"},ct={class:"data-table"},ht={class:"col-id"},pt={class:"col-toggle"},ft={class:"col-title"},ut={class:"col-stat"},mt=["onClick"],gt={class:"col-stat"},Ct=["onClick"],vt={class:"col-stat"},yt=["onClick"],kt={class:"col-stat"},bt=["onClick"],wt={class:"col-actions"},_t=["onClick"],Dt=["onClick"],xt={key:1,class:"empty-state"};function Vt(a,t,o,w,e,l){const _=D("Header"),u=D("Toogle"),m=D("Popup"),g=D("router-link");return d(),n("div",H,[h(_,{ref:"header"},null,512),e.loader?(d(),n("div",E,[s("img",{src:e.loaderGif,alt:"Loading..."},null,8,R)])):p("",!0),s("div",P,[s("div",S,[s("div",z,[s("a",{class:"btn-primary",href:"#",onClick:t[0]||(t[0]=f(i=>{e.formData={},a.$refs.new.active=1},["prevent"]))},[...t[14]||(t[14]=[s("i",{class:"fas fa-plus"},null,-1),v(" New ",-1)])])]),s("div",O,[y(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>e.date=i),onChange:t[2]||(t[2]=i=>l.get()),class:"date-input"},null,544),[[k,e.date]]),t[15]||(t[15]=s("span",{class:"date-separator"},"â€”",-1)),y(s("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=i=>e.date2=i),onChange:t[4]||(t[4]=i=>l.get()),class:"date-input"},null,544),[[k,e.date2]])]),t[16]||(t[16]=s("div",{class:"toolbar-right"},[s("h1",{class:"page-title"},"Campaigns")],-1))]),h(m,{ref:"chart",fullscreen:"true",title:"Chart"},{default:b(()=>[s("div",j,[s("div",q,[y(s("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=i=>e.date=i),onChange:t[6]||(t[6]=i=>l.getChart()),class:"date-input"},null,544),[[k,e.date]]),y(s("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=i=>e.date2=i),onChange:t[8]||(t[8]=i=>l.getChart()),class:"date-input"},null,544),[[k,e.date2]])]),s("div",M,[s("div",G,[s("div",W,[t[17]||(t[17]=s("div",{style:{"font-weight":"bold",color:"#fff"}},"Clicks",-1)),v(" "+c(e.data.items&&e.data.items[e.iChart]?e.data.items[e.iChart].clicks:0),1)]),s("div",Z,[t[18]||(t[18]=s("div",{style:{"font-weight":"bold",color:"#fff"}},"Views",-1)),v(" "+c(e.data.items&&e.data.items[e.iChart]?e.data.items[e.iChart].views:0),1)]),s("div",Y,[t[19]||(t[19]=s("div",null,"Leads",-1)),v(" "+c(e.data.items&&e.data.items[e.iChart]?e.data.items[e.iChart].leads:0),1)]),s("div",J,[t[20]||(t[20]=s("div",null,"CTR",-1)),v(" "+c(e.data.items&&e.data.items[e.iChart]&&e.data.items[e.iChart].views>0?(e.data.items[e.iChart].clicks*100/e.data.items[e.iChart].views).toFixed(2):"0.00")+"% ",1)])])])]),s("div",K,[s("div",Q,[e.data.items&&e.data.items[e.iChart]&&e.data.items[e.iChart].sites?(d(),n("div",X,[h(u,{modelValue:e.all,"onUpdate:modelValue":[t[9]||(t[9]=i=>e.all=i),t[10]||(t[10]=i=>{e.all=i,l.checkAll(i)})]},null,8,["modelValue"]),t[21]||(t[21]=s("strong",null,"ALL",-1))])):p("",!0),t[22]||(t[22]=s("hr",{style:{border:"0","border-top":"1px solid #eee",margin:"10px 0"}},null,-1)),e.data.items&&e.data.items[e.iChart]?(d(!0),n(x,{key:1},V(e.data.items[e.iChart].sites,(i,C)=>(d(),n("div",{class:"itemchart ptb10",style:{padding:"5px 0",display:"flex","align-items":"center",gap:"10px"},key:i.site||C},[h(u,{modelValue:i.include,"onUpdate:modelValue":[r=>i.include=r,t[11]||(t[11]=r=>{e.formData=e.data.items[e.iChart],l.getChart()})]},null,8,["modelValue","onUpdate:modelValue"]),s("span",$,c(i.site),1)]))),128)):p("",!0)]),s("div",tt,[s("div",et,[...t[23]||(t[23]=[s("div",{class:"chartHintsViews",style:{color:"#6c5ce7","font-weight":"bold"}}," Views ",-1),s("div",{class:"chartHintsClicks",style:{color:"#0984e3","font-weight":"bold"}}," Clicks ",-1)])],512),s("div",st,[s("canvas",it,null,512)])],512)])]),_:1},512),h(m,{ref:"new",title:e.formData&&e.formData.id?"Edit campaign":"New campaign"},{default:b(()=>[s("div",at,[e.formData?(d(),n("form",{key:0,onSubmit:t[13]||(t[13]=f(i=>l.action(),["prevent"]))},[s("div",ot,[t[24]||(t[24]=s("label",null,"Name",-1)),y(s("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=i=>e.formData.title=i),required:"",placeholder:"Enter campaign name...",class:"text-input"},null,512),[[k,e.formData.title]])]),s("div",lt,[e.formData&&e.formData.id?(d(),n("button",rt," Save Changes ")):p("",!0),e.formData&&!e.formData.id?(d(),n("button",nt," Add Campaign ")):p("",!0)])],32)):p("",!0)])]),_:1},8,["title"]),e.data.items&&e.data.items.length>0?(d(),n("div",dt,[s("table",ct,[t[28]||(t[28]=s("thead",null,[s("tr",null,[s("th",{class:"col-id"},"#"),s("th",{class:"col-toggle"},"Status"),s("th",null,"Title"),s("th",{class:"col-stat"},"Views"),s("th",{class:"col-stat"},"Clicks"),s("th",{class:"col-stat"},"Leads"),s("th",{class:"col-stat"},"Fraud"),s("th",{class:"col-actions"},"Actions")])],-1)),s("tbody",null,[(d(!0),n(x,null,V(e.data.items,(i,C)=>(d(),n("tr",{key:i.id||C},[s("td",ht,c(i.id),1),s("td",pt,[h(u,{modelValue:i.published,"onUpdate:modelValue":[r=>i.published=r,r=>{e.formData=i,l.action()}]},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ft,[h(g,{to:"/campaign/"+i.id,class:"link-primary"},{default:b(()=>[v(c(i.title),1)]),_:2},1032,["to"])]),s("td",ut,[s("a",{href:"#",onClick:f(r=>l.openDetails(i.id,1),["prevent"])},c(i.views),9,mt)]),s("td",gt,[s("a",{href:"#",onClick:f(r=>l.openDetails(i.id,2),["prevent"])},c(i.clicks||0),9,Ct)]),s("td",vt,[s("a",{href:"#",onClick:f(r=>l.openDetails(i.id,3),["prevent"])},c(i.leads||0),9,yt)]),s("td",kt,[s("a",{href:"#",onClick:f(r=>l.openDetails(i.id,4),["prevent"])},c(i.fclicks||0),9,bt)]),s("td",wt,[h(g,{to:"/campaign/"+i.id,style:{"margin-right":"8px",color:"#888"}},{default:b(()=>[...t[25]||(t[25]=[s("i",{class:"fas fa-edit"},null,-1)])]),_:1},8,["to"]),s("a",{href:"#",onClick:f(r=>{e.formData=i,e.iChart=C,a.$refs.chart.active=1,l.line(i)},["prevent"]),style:{"margin-right":"8px",color:"#888"}},[...t[26]||(t[26]=[s("i",{class:"fas fa-chart-bar"},null,-1)])],8,_t),s("a",{href:"#",onClick:f(r=>{e.formData=i,l.del(i)},["prevent"]),class:"icon-delete"},[...t[27]||(t[27]=[s("i",{class:"fas fa-trash-alt"},null,-1)])],8,Dt)])]))),128))])])])):p("",!0),!e.data.items||e.data.items.length===0?(d(),n("div",xt," No items found ")):p("",!0)]),h(m,{ref:"details",title:"Campaign Details"},{default:b(()=>[...t[29]||(t[29]=[s("div",{class:"popup-content"},[s("p",null,"Details for campaign loaded in console.")],-1)])]),_:1},512)])}const Bt=L(T,[["render",Vt],["__scopeId","data-v-2c562265"]]);export{Bt as default};
